Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# run the algorithm on a high dimensional gaussian, and show two of the dimensions

logdensity_fn = lambda x: -0.5 * jnp.sum(jnp.square(x))
num_steps = 10000
transform = lambda state, info: state.position[:2]


sample_key, rng_key = jax.random.split(rng_key)
samples, initial_state, params, chain_key = run_mclmc(
    logdensity_fn=logdensity_fn,
    num_steps=num_steps,
    initial_position=jnp.ones((1000,)),
    key=sample_key,
    transform=transform,
)
samples.mean()
------------------


[31m---------------------------------------------------------------------------[39m
[31mTypeError[39m                                 Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[3][39m[32m, line 9[39m
[32m      5[39m transform = [38;5;28;01mlambda[39;00m state, info: state.position[:[32m2[39m]
[32m      8[39m sample_key, rng_key = jax.random.split(rng_key)
[32m----> [39m[32m9[39m samples, initial_state, params, chain_key = [43mrun_mclmc[49m[43m([49m
[32m     10[39m [43m    [49m[43mlogdensity_fn[49m[43m=[49m[43mlogdensity_fn[49m[43m,[49m
[32m     11[39m [43m    [49m[43mnum_steps[49m[43m=[49m[43mnum_steps[49m[43m,[49m
[32m     12[39m [43m    [49m[43minitial_position[49m[43m=[49m[43mjnp[49m[43m.[49m[43mones[49m[43m([49m[43m([49m[32;43m1000[39;49m[43m,[49m[43m)[49m[43m)[49m[43m,[49m
[32m     13[39m [43m    [49m[43mkey[49m[43m=[49m[43msample_key[49m[43m,[49m
[32m     14[39m [43m    [49m[43mtransform[49m[43m=[49m[43mtransform[49m[43m,[49m
[32m     15[39m [43m)[49m
[32m     16[39m samples.mean()

[36mCell[39m[36m [39m[32mIn[2][39m[32m, line 20[39m, in [36mrun_mclmc[39m[34m(logdensity_fn, num_steps, initial_position, key, transform, desired_energy_variance)[39m
[32m     10[39m kernel = [38;5;28;01mlambda[39;00m sqrt_diag_cov : blackjax.mcmc.mclmc.build_kernel(
[32m     11[39m     logdensity_fn=logdensity_fn,
[32m     12[39m     integrator=blackjax.mcmc.integrators.isokinetic_mclachlan,
[32m     13[39m     sqrt_diag_cov=sqrt_diag_cov,
[32m     14[39m )
[32m     16[39m [38;5;66;03m# find values for L and step_size[39;00m
[32m     17[39m (
[32m     18[39m     blackjax_state_after_tuning,
[32m     19[39m     blackjax_mclmc_sampler_params,
[32m---> [39m[32m20[39m ) = [43mblackjax[49m[43m.[49m[43mmclmc_find_L_and_step_size[49m[43m([49m
[32m     21[39m [43m    [49m[43mmclmc_kernel[49m[43m=[49m[43mkernel[49m[43m,[49m
[32m     22[39m [43m    [49m[43mnum_steps[49m[43m=[49m[43mnum_steps[49m[43m,[49m
[32m     23[39m [43m    [49m[43mstate[49m[43m=[49m[43minitial_state[49m[43m,[49m
[32m     24[39m [43m    [49m[43mrng_key[49m[43m=[49m[43mtune_key[49m[43m,[49m
[32m     25[39m [43m    [49m[43mdiagonal_preconditioning[49m[43m=[49m[38;5;28;43;01mFalse[39;49;00m[43m,[49m
[32m     26[39m [43m    [49m[43mdesired_energy_var[49m[43m=[49m[43mdesired_energy_variance[49m
[32m     27[39m [43m[49m[43m)[49m
[32m     29[39m [38;5;66;03m# use the quick wrapper to build a new kernel with the tuned parameters[39;00m
[32m     30[39m sampling_alg = blackjax.mclmc(
[32m     31[39m     logdensity_fn,
[32m     32[39m     L=blackjax_mclmc_sampler_params.L,
[32m     33[39m     step_size=blackjax_mclmc_sampler_params.step_size,
[32m     34[39m )

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/blackjax/adaptation/mclmc_adaptation.py:125[39m, in [36mmclmc_find_L_and_step_size[39m[34m(mclmc_kernel, num_steps, state, rng_key, frac_tune1, frac_tune2, frac_tune3, desired_energy_var, trust_in_estimate, num_effective_samples, diagonal_preconditioning, params)[39m
[32m    122[39m num_steps2 += diagonal_preconditioning * (num_steps2 // [32m3[39m)
[32m    123[39m num_steps3 = [38;5;28mround[39m(num_steps * frac_tune3)
[32m--> [39m[32m125[39m state, params = [43mmake_L_step_size_adaptation[49m[43m([49m
[32m    126[39m [43m    [49m[43mkernel[49m[43m=[49m[43mmclmc_kernel[49m[43m,[49m
[32m    127[39m [43m    [49m[43mdim[49m[43m=[49m[43mdim[49m[43m,[49m
[32m    128[39m [43m    [49m[43mfrac_tune1[49m[43m=[49m[43mfrac_tune1[49m[43m,[49m
[32m    129[39m [43m    [49m[43mfrac_tune2[49m[43m=[49m[43mfrac_tune2[49m[43m,[49m
[32m    130[39m [43m    [49m[43mdesired_energy_var[49m[43m=[49m[43mdesired_energy_var[49m[43m,[49m
[32m    131[39m [43m    [49m[43mtrust_in_estimate[49m[43m=[49m[43mtrust_in_estimate[49m[43m,[49m
[32m    132[39m [43m    [49m[43mnum_effective_samples[49m[43m=[49m[43mnum_effective_samples[49m[43m,[49m
[32m    133[39m [43m    [49m[43mdiagonal_preconditioning[49m[43m=[49m[43mdiagonal_preconditioning[49m[43m,[49m
[32m    134[39m [43m[49m[43m)[49m[43m([49m[43mstate[49m[43m,[49m[43m [49m[43mparams[49m[43m,[49m[43m [49m[43mnum_steps[49m[43m,[49m[43m [49m[43mpart1_key[49m[43m)[49m
[32m    135[39m total_num_tuning_integrator_steps += num_steps1 + num_steps2
[32m    137[39m [38;5;28;01mif[39;00m num_steps3 >= [32m2[39m:  [38;5;66;03m# at least 2 samples for ESS estimation[39;00m

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/blackjax/adaptation/mclmc_adaptation.py:258[39m, in [36mmake_L_step_size_adaptation.<locals>.L_step_size_adaptation[39m[34m(state, params, num_steps, rng_key)[39m
[32m    255[39m mask = jnp.concatenate((jnp.zeros(num_steps1), jnp.ones(num_steps2)))
[32m    257[39m [38;5;66;03m# run the steps[39;00m
[32m--> [39m[32m258[39m state, params, _, (_, average) = [43mrun_steps[49m[43m([49m
[32m    259[39m [43m    [49m[43mxs[49m[43m=[49m[43m([49m[43mmask[49m[43m,[49m[43m [49m[43mL_step_size_adaptation_keys[49m[43m)[49m[43m,[49m[43m [49m[43mstate[49m[43m=[49m[43mstate[49m[43m,[49m[43m [49m[43mparams[49m[43m=[49m[43mparams[49m
[32m    260[39m [43m[49m[43m)[49m
[32m    262[39m L = params.L
[32m    263[39m [38;5;66;03m# determine L[39;00m

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/blackjax/adaptation/mclmc_adaptation.py:230[39m, in [36mmake_L_step_size_adaptation.<locals>.<lambda>[39m[34m(xs, state, params)[39m
[32m    222[39m     streaming_avg = incremental_value_update(
[32m    223[39m         expectation=jnp.array([x, jnp.square(x)]),
[32m    224[39m         incremental_val=streaming_avg,
[32m    225[39m         weight=mask * success * params.step_size,
[32m    226[39m     )
[32m    228[39m     [38;5;28;01mreturn[39;00m (state, params, adaptive_state, streaming_avg), [38;5;28;01mNone[39;00m
[32m--> [39m[32m230[39m run_steps = [38;5;28;01mlambda[39;00m xs, state, params: [43mjax[49m[43m.[49m[43mlax[49m[43m.[49m[43mscan[49m[43m([49m
[32m    231[39m [43m    [49m[43mstep[49m[43m,[49m
[32m    232[39m [43m    [49m[43minit[49m[43m=[49m[43m([49m
[32m    233[39m [43m        [49m[43mstate[49m[43m,[49m
[32m    234[39m [43m        [49m[43mparams[49m[43m,[49m
[32m    235[39m [43m        [49m[43m([49m[32;43m0.0[39;49m[43m,[49m[43m [49m[32;43m0.0[39;49m[43m,[49m[43m [49m[43mjnp[49m[43m.[49m[43minf[49m[43m)[49m[43m,[49m
[32m    236[39m [43m        [49m[43m([49m[32;43m0.0[39;49m[43m,[49m[43m [49m[43mjnp[49m[43m.[49m[43marray[49m[43m([49m[43m[[49m[43mjnp[49m[43m.[49m[43mzeros[49m[43m([49m[43mdim[49m[43m)[49m[43m,[49m[43m [49m[43mjnp[49m[43m.[49m[43mzeros[49m[43m([49m[43mdim[49m[43m)[49m[43m][49m[43m)[49m[43m)[49m[43m,[49m
[32m    237[39m [43m    [49m[43m)[49m[43m,[49m
[32m    238[39m [43m    [49m[43mxs[49m[43m=[49m[43mxs[49m[43m,[49m
[32m    239[39m [43m[49m[43m)[49m[[32m0[39m]
[32m    241[39m [38;5;28;01mdef[39;00m[38;5;250m [39m[34mL_step_size_adaptation[39m(state, params, num_steps, rng_key):
[32m    242[39m     num_steps1, num_steps2 = [38;5;28mround[39m(num_steps * frac_tune1), [38;5;28mround[39m(
[32m    243[39m         num_steps * frac_tune2
[32m    244[39m     )

    [31m[... skipping hidden 10 frame][39m

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/blackjax/adaptation/mclmc_adaptation.py:216[39m, in [36mmake_L_step_size_adaptation.<locals>.step[39m[34m(iteration_state, weight_and_key)[39m
[32m    213[39m mask, rng_key = weight_and_key
[32m    214[39m state, params, adaptive_state, streaming_avg = iteration_state
[32m--> [39m[32m216[39m state, params, adaptive_state, success = [43mpredictor[49m[43m([49m
[32m    217[39m [43m    [49m[43mstate[49m[43m,[49m[43m [49m[43mparams[49m[43m,[49m[43m [49m[43madaptive_state[49m[43m,[49m[43m [49m[43mrng_key[49m
[32m    218[39m [43m[49m[43m)[49m
[32m    220[39m x = ravel_pytree(state.position)[[32m0[39m]
[32m    221[39m [38;5;66;03m# update the running average of x, x^2[39;00m

[36mFile [39m[32m/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/blackjax/adaptation/mclmc_adaptation.py:169[39m, in [36mmake_L_step_size_adaptation.<locals>.predictor[39m[34m(previous_state, params, adaptive_state, rng_key)[39m
[32m    166[39m rng_key, nan_key = jax.random.split(rng_key)
[32m    168[39m [38;5;66;03m# dynamics[39;00m
[32m--> [39m[32m169[39m next_state, info = [43mkernel[49m[43m([49m[43mparams[49m[43m.[49m[43minverse_mass_matrix[49m[43m)[49m(
[32m    170[39m     rng_key=rng_key,
[32m    171[39m     state=previous_state,
[32m    172[39m     L=params.L,
[32m    173[39m     step_size=params.step_size,
[32m    174[39m )
[32m    176[39m [38;5;66;03m# step updating[39;00m
[32m    177[39m success, state, step_size_max, energy_change = handle_nans(
[32m    178[39m     previous_state,
[32m    179[39m     next_state,
[32m   (...)[39m[32m    183[39m     nan_key,
[32m    184[39m )

[36mCell[39m[36m [39m[32mIn[2][39m[32m, line 10[39m, in [36mrun_mclmc.<locals>.<lambda>[39m[34m(sqrt_diag_cov)[39m
[32m      5[39m initial_state = blackjax.mcmc.mclmc.init(
[32m      6[39m     position=initial_position, logdensity_fn=logdensity_fn, rng_key=init_key
[32m      7[39m )
[32m      9[39m [38;5;66;03m# build the kernel[39;00m
[32m---> [39m[32m10[39m kernel = [38;5;28;01mlambda[39;00m sqrt_diag_cov : [43mblackjax[49m[43m.[49m[43mmcmc[49m[43m.[49m[43mmclmc[49m[43m.[49m[43mbuild_kernel[49m[43m([49m
[32m     11[39m [43m    [49m[43mlogdensity_fn[49m[43m=[49m[43mlogdensity_fn[49m[43m,[49m
[32m     12[39m [43m    [49m[43mintegrator[49m[43m=[49m[43mblackjax[49m[43m.[49m[43mmcmc[49m[43m.[49m[43mintegrators[49m[43m.[49m[43misokinetic_mclachlan[49m[43m,[49m
[32m     13[39m [43m    [49m[43msqrt_diag_cov[49m[43m=[49m[43msqrt_diag_cov[49m[43m,[49m
[32m     14[39m [43m[49m[43m)[49m
[32m     16[39m [38;5;66;03m# find values for L and step_size[39;00m
[32m     17[39m (
[32m     18[39m     blackjax_state_after_tuning,
[32m     19[39m     blackjax_mclmc_sampler_params,
[32m   (...)[39m[32m     26[39m     desired_energy_var=desired_energy_variance
[32m     27[39m )

[31mTypeError[39m: build_kernel() got an unexpected keyword argument 'sqrt_diag_cov'

